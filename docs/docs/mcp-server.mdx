---
title: MCP Server
sidebar_position: 6
---

# MCP Server

The MCP service provides a Model Context Protocol interface for AI clients to access Archon's functionality via HTTP.

## Architecture

MCP is a **protocol adapter** that:
1. Receives MCP tool calls from AI clients
2. Translates them to HTTP requests to the Server API
3. Returns formatted responses to AI clients

```
AI Client (Cursor/Windsurf) → MCP Protocol → MCP Server → HTTP → Server API
```

## Available Tools

### RAG Tools (7)

| Tool | Purpose | Server Endpoint |
|------|---------|----------------|
| `perform_rag_query` | Semantic search | `POST /api/rag/query` |
| `search_code_examples` | Code search | `POST /api/rag/code-search` |
| `crawl_single_page` | Crawl one URL | `POST /api/knowledge-items/crawl` |
| `smart_crawl_url` | Smart crawling | `POST /api/knowledge-items/crawl` |
| `get_available_sources` | List sources | `GET /api/rag/sources` |
| `upload_document` | Upload docs | `POST /api/documents/upload` |
| `delete_source` | Delete source | `DELETE /api/sources/{id}` |

### Project Tools (5)

| Tool | Actions | Description |
|------|---------|-------------|
| `manage_project` | create, list, get, delete | Project CRUD operations |
| `manage_task` | create, list, get, update, delete, archive | Task management |
| `manage_document` | add, list, get, update, delete | Document management |
| `manage_versions` | create, list, get, restore | Version control |
| `get_project_features` | - | Get project features |

### System Tools (2)

| Tool | Purpose |
|------|---------|
| `health_check` | System health status |
| `session_info` | Active session info |

## Implementation Pattern

All MCP tools follow the same pattern:

```python
@mcp.tool()
async def delete_source(ctx: Context, source: str) -> str:
    """Delete a source via HTTP call to Server API"""
    client = get_mcp_service_client()
    async with httpx.AsyncClient() as http:
        response = await http.delete(
            f"{client.api_url}/api/sources/{source}",
            headers=client._get_headers()
        )
        return json.dumps(response.json())
```

## Configuration

### Environment Variables

```bash
# Server connection
API_BASE_URL=http://archon-server:8080
AGENTS_BASE_URL=http://archon-agents:8052

# Authentication
MCP_SERVICE_KEY=your-service-key

# Transport Configuration
ARCHON_MCP_ENABLE_STREAMABLE_HTTP=true  # Enable Streamable HTTP at /mcp (recommended)
ARCHON_MCP_ENABLE_SSE=true              # Enable SSE at /sse (legacy support)
# Note: At least one transport must be enabled

# Unified Logging Configuration (Optional)
LOGFIRE_ENABLED=false              # true=Logfire logging, false=standard logging
LOGFIRE_TOKEN=your-logfire-token    # Only required when LOGFIRE_ENABLED=true
```

### Transport Configuration

Control which transport protocols the MCP server exposes:

- **`ARCHON_MCP_ENABLE_STREAMABLE_HTTP`** (default: `true`): Enable modern Streamable HTTP transport at `/mcp`
- **`ARCHON_MCP_ENABLE_SSE`** (default: `true`): Enable legacy SSE transport at `/sse`

Both transports are enabled by default for maximum compatibility. You can disable one if you only need a single transport:

```bash
# Streamable HTTP only (recommended for new deployments)
ARCHON_MCP_ENABLE_STREAMABLE_HTTP=true
ARCHON_MCP_ENABLE_SSE=false

# SSE only (legacy systems)
ARCHON_MCP_ENABLE_STREAMABLE_HTTP=false
ARCHON_MCP_ENABLE_SSE=true
```

> **Important**: At least one transport must be enabled. The server will fail to start if both are disabled.

### Docker Service

```yaml
archon-mcp:
  build: ./python
  ports:
    - "8051:8000"
  environment:
    - API_BASE_URL=http://archon-server:8080
  command: ["python", "-m", "src.mcp.mcp_server"]
```

## Transport Support

Archon MCP server supports **dual transport** for maximum compatibility:

### Available Transports

| Transport | Endpoint | Status | Recommended |
|-----------|----------|--------|-------------|
| **Streamable HTTP** | `/mcp` | Active | ✅ Modern MCP clients |
| **SSE** | `/sse` | Legacy | ⚠️ Backward compatibility only |

### When to Use Each Transport

**Use Streamable HTTP (`/mcp`) when:**
- Using modern MCP clients (Claude Code, Claude Desktop, latest Cursor)
- Starting new integrations
- You want the latest MCP protocol features (2025-03-26 spec)

**Use SSE (`/sse`) when:**
- Maintaining existing integrations that rely on SSE
- Using older MCP clients that don't support Streamable HTTP
- You need backward compatibility with legacy systems

> **Migration Note**: SSE transport is maintained for backward compatibility but is considered legacy. New integrations should use Streamable HTTP (`/mcp`).

## Client Configuration

### Claude Code (Recommended)

**Streamable HTTP (Recommended):**
```bash
claude mcp add archon http://localhost:8051/mcp
```

**SSE (Legacy):**
```bash
claude mcp add --transport sse archon http://localhost:8051/sse
```

### Cursor IDE

**Streamable HTTP (Recommended):**
```json
{
  "mcpServers": {
    "archon": {
      "url": "http://localhost:8051/mcp",
      "transport": "streamable-http"
    }
  }
}
```

**SSE (Legacy):**
```json
{
  "mcpServers": {
    "archon": {
      "uri": "http://localhost:8051/sse"
    }
  }
}
```

### Windsurf IDE

**Streamable HTTP (Recommended):**
```json
{
  "mcp.servers": {
    "archon": {
      "url": "http://localhost:8051/mcp",
      "transport": "streamable-http"
    }
  }
}
```

**SSE (Legacy):**
```json
{
  "mcp.servers": {
    "archon": {
      "uri": "http://localhost:8051/sse"
    }
  }
}
```

## Tool Usage Examples

### RAG Query
```typescript
const results = await mcp.perform_rag_query({
  query: "How to implement authentication",
  source: "fastapi.tiangolo.com",
  match_count: 5
});
```

### Create Project
```typescript
const project = await mcp.manage_project({
  action: "create",
  title: "New AI Project",
  github_repo: "https://github.com/user/repo"
});
```

### Delete Source
```typescript
const result = await mcp.delete_source({
  source: "outdated-docs.com"
});
```

## Monitoring

All MCP operations are tracked in Logfire:
- Tool invocation metrics
- HTTP request/response times
- Error rates and debugging
- Session management

## Important Notes

- **No business logic** - MCP only translates protocols
- **HTTP-only communication** - No direct database access
- **Stateless operations** - Each tool call is independent
- **Full observability** - Every operation is logged